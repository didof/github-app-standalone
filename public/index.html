<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Homepage</title>
  </head>
  <body>
    <a id="oauth-github-popup">Authenticate via GitHub (popup)</a>
    <script>
      const CLIENT_ID = "Iv1.395930440f268143";

      const url = new URL("/login/oauth/authorize", "https://github.com");
      url.searchParams.set("client_id", CLIENT_ID);

      const popupA = document.getElementById("oauth-github-popup");
      popupA.setAttribute("href", url);
      popupA.addEventListener("click", (event) => {
        event.preventDefault();

        const features = {
          popup: "yes",
          width: 600,
          height: 700,
          top: "auto",
          left: "auto",
          toolbar: "no",
          menubar: "no",
        };

        const strWindowsFeatures = Object.entries(features)
          .reduce((str, [key, value]) => {
            if (value == "auto") {
              if (key === "top") {
                const v = Math.round(
                  window.innerHeight / 2 - features.height / 2
                );
                str += `top=${v},`;
              } else if (key === "left") {
                const v = Math.round(
                  window.innerWidth / 2 - features.width / 2
                );
                str += `left=${v},`;
              }
              return str;
            }

            str += `${key}=${value},`;
            return str;
          }, "")
          .slice(0, -1);

        window.open(url, "_blank", strWindowsFeatures);
      });

      window.addEventListener("message", receiveMessage, false);

      function receiveMessage(event) {
        if (event.origin !== window.location.origin) {
          console.warn(`Message received by ${event.origin}; IGNORED.`);
          return;
        }

        const access_token = event.data;

        console.log(access_token); // save this in storage, cookie and use it with GitHub REST API
      }
    </script>
  </body>
</html>
